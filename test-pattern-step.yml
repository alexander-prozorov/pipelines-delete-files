parameters:
- name: 'pattern'
  type: string
- name: 'files'
  type: string
- name: 'displayName'
  type: string

steps:
- task: CopyFiles@2
  displayName: 'Copy files to temp directory'
  inputs:
    SourceFolder: 'files'
    Contents: '**'
    TargetFolder: 'temp'
- task: DeleteFiles@1
  displayName: ${{ parameters.displayName }}
  inputs:
    SourceFolder: $(Build.SourcesDirectory)/temp
    Contents: ${{ parameters.pattern }}
- task: Bash@3
  displayName: 'Check deleted files'
  inputs:
    targetType: 'inline'
    script: |
      existing=$(find temp -type f | xargs)
      if [ "$existing" != "${{ parameters.files }}" ]; then
        echo "Existing files: $existing, expected: ${{ parameters.files }}"; exit 1;
      fi 
